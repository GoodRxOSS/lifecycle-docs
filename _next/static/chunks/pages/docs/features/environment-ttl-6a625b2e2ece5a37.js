(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5104],{1513:(e,n,t)=>{"use strict";t.d(n,{R:()=>c});var i=t(91668),r=t(54587),l=t.n(r),s=t(14232);let d={img:e=>(0,s.createElement)("object"==typeof e.src?l():"img",e)},c=e=>(0,i.R)({...d,...e})},1967:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>a,useTOC:()=>c});var i=t(37876),r=t(71807),l=t(1781),s=t(1513),d=t(19941);function c(e){let n={code:"code",...(0,s.R)()};return[{value:"Configuration",id:"configuration",depth:2},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"enabled"})}),id:"enabled",depth:3},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"dryRun"})}),id:"dryrun",depth:3},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"inactivityDays"})}),id:"inactivitydays",depth:3},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"checkIntervalMinutes"})}),id:"checkintervalminutes",depth:3},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"commentTemplate"})}),id:"commenttemplate",depth:3},{value:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(n.code,{children:"excludedRepositories"})}),id:"excludedrepositories",depth:3},{value:"How It Works",id:"how-it-works",depth:2},{value:"Preventing Cleanup",id:"preventing-cleanup",depth:3},{value:"Summary",id:"summary",depth:2}]}let a=(0,r.e)(function(e){let{toc:n=c(e)}=e,t={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components},{Code:r}=t;return r||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Code",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Lifecycle automatically cleans up inactive ephemeral environments based on configurable TTL (Time To Live) settings. This helps reduce resource usage while allowing teams to keep environments alive when needed."}),"\n",(0,i.jsx)(t.h2,{id:n[0].id,children:n[0].value}),"\n",(0,i.jsxs)(t.p,{children:["The TTL cleanup configuration is stored in the ",(0,i.jsx)(t.code,{children:"global_config"})," table with the key ",(0,i.jsx)(t.code,{children:"ttl_cleanup"}),":"]}),"\n",(0,i.jsx)(r,{codeblock:{value:'{\n  "enabled": true,\n  "dryRun": false,\n  "inactivityDays": 14,\n  "checkIntervalMinutes": 240,\n  "commentTemplate": "This environment has been inactive for {inactivityDays} days and will be automatically cleaned up.",\n  "excludedRepositories": []\n}',lang:"json",meta:"",code:'{\n  "enabled": true,\n  "dryRun": false,\n  "inactivityDays": 14,\n  "checkIntervalMinutes": 240,\n  "commentTemplate": "This environment has been inactive for {inactivityDays} days and will be automatically cleaned up.",\n  "excludedRepositories": []\n}',tokens:[["{","#C9D1D9"],"\n  ",['"enabled"',"#7EE787"],[":","#C9D1D9"]," ",["true","#79C0FF"],[",","#C9D1D9"],"\n  ",['"dryRun"',"#7EE787"],[":","#C9D1D9"]," ",["false","#79C0FF"],[",","#C9D1D9"],"\n  ",['"inactivityDays"',"#7EE787"],[":","#C9D1D9"]," ",["14","#79C0FF"],[",","#C9D1D9"],"\n  ",['"checkIntervalMinutes"',"#7EE787"],[":","#C9D1D9"]," ",["240","#79C0FF"],[",","#C9D1D9"],"\n  ",['"commentTemplate"',"#7EE787"],[":","#C9D1D9"]," ",['"This environment has been inactive for {inactivityDays} days and will be automatically cleaned up."',"#A5D6FF"],[",","#C9D1D9"],"\n  ",['"excludedRepositories"',"#7EE787"],[": []","#C9D1D9"],"\n",["}","#C9D1D9"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,i.jsx)(t.h3,{id:n[1].id,children:n[1].value}),"\n",(0,i.jsx)(t.p,{children:"Enables or disables automatic cleanup of inactive environments."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:"false"})]}),"\n",(0,i.jsx)(t.h3,{id:n[2].id,children:n[2].value}),"\n",(0,i.jsx)(t.p,{children:"Runs cleanup process without actually tearing down environments. Useful for testing."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:"true"})]}),"\n",(0,i.jsx)(t.h3,{id:n[3].id,children:n[3].value}),"\n",(0,i.jsx)(t.p,{children:"Number of days of inactivity before an environment is eligible for cleanup."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:"14"})]}),"\n",(0,i.jsx)(t.h3,{id:n[4].id,children:n[4].value}),"\n",(0,i.jsx)(t.p,{children:"How frequently the cleanup job runs to check for stale environments."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:"240"})," (4 hours)"]}),"\n",(0,i.jsx)(t.h3,{id:n[5].id,children:n[5].value}),"\n",(0,i.jsxs)(t.p,{children:["Custom message posted to the PR when cleaning up. Supports ",(0,i.jsx)(t.code,{children:"{inactivityDays}"})," placeholder and dynamic label replacements."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:'"Tearing down lifecycle env since no activity in the past {inactivityDays} days."'})]}),"\n",(0,i.jsx)(t.h3,{id:n[6].id,children:n[6].value}),"\n",(0,i.jsxs)(t.p,{children:["Repository names (format: ",(0,i.jsx)(t.code,{children:"owner/repo"}),") to exclude from automatic cleanup."]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Default:"})," ",(0,i.jsx)(t.code,{children:"[]"})]}),"\n",(0,i.jsx)(d.P,{type:"warning",children:(0,i.jsx)(t.p,{children:"Changes to TTL configuration require refreshing the global config cache or\nwaiting for the automatic refresh cycle."})}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:n[7].id,children:n[7].value}),"\n",(0,i.jsxs)(t.p,{children:["Lifecycle tracks environment expiration using ",(0,i.jsx)(t.code,{children:"lfc/ttl-expireAtUnix"})," labels on Kubernetes namespaces. The cleanup service runs periodically to scan for expired environments, validates eligibility (PR is open, not static, not excluded), and tears down environments by removing the deploy label and adding the disabled label."]}),"\n",(0,i.jsx)(t.h3,{id:n[8].id,children:n[8].value}),"\n",(0,i.jsxs)(t.p,{children:["Add the ",(0,i.jsx)(t.code,{children:"keep"})," label to a PR to prevent automatic cleanup. This disables TTL on the namespace and keeps the environment alive indefinitely. See ",(0,i.jsx)(t.a,{href:"/docs/features/configurable-labels",children:"Configurable Labels"})," to customize the keep label."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h2,{id:n[9].id,children:n[9].value}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Property"}),(0,i.jsx)(t.th,{children:"Type"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"enabled"})}),(0,i.jsx)(t.td,{children:"boolean"}),(0,i.jsx)(t.td,{children:"Enable/disable automatic cleanup"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"dryRun"})}),(0,i.jsx)(t.td,{children:"boolean"}),(0,i.jsx)(t.td,{children:"Test mode without actual cleanup"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"inactivityDays"})}),(0,i.jsx)(t.td,{children:"number"}),(0,i.jsx)(t.td,{children:"Days of inactivity before cleanup"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"checkIntervalMinutes"})}),(0,i.jsx)(t.td,{children:"number"}),(0,i.jsx)(t.td,{children:"Cleanup job frequency in minutes"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"commentTemplate"})}),(0,i.jsx)(t.td,{children:"string"}),(0,i.jsx)(t.td,{children:"Custom cleanup message for PRs"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"excludedRepositories"})}),(0,i.jsx)(t.td,{children:"string[]"}),(0,i.jsx)(t.td,{children:"Repositories excluded from cleanup"})]})]})]})]})},"/docs/features/environment-ttl",{filePath:"src/pages/docs/features/environment-ttl.mdx",timestamp:177162007e4,pageMap:l.O,frontMatter:{title:"Environment TTL",tags:["ttl","cleanup","lifecycle-keep","inactivity","global-config"]},title:"Environment TTL"},"undefined"==typeof RemoteContent?c:RemoteContent.useTOC)},55420:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/features/environment-ttl",function(){return t(1967)}])},71807:(e,n,t)=>{"use strict";t.d(n,{e:()=>a});var i=t(37876),r=t(20181),l=t(27096);let s=(0,t(14232).createContext)({}),d=s.Provider;s.displayName="SSG";var c=t(1513);function a(e,n,t,i){let l=globalThis[r.VZ];return l.route=n,l.pageMap=t.pageMap,l.context[n]={Content:e,pageOpts:t,useTOC:i},o}function o({__nextra_pageMap:e=[],__nextra_dynamic_opts:n,...t}){let s=globalThis[r.VZ],{Layout:c,themeConfig:a}=s,{route:o,locale:u}=(0,l.r)(),p=s.context[o];if(!p)throw Error(`No content found for the "${o}" route. Please report it as a bug.`);let{pageOpts:x,useTOC:j,Content:m}=p;if(o.startsWith("/["))x.pageMap=e;else for(let{route:n,children:t}of e){let e=n.split("/").slice(u?2:1);(function e(n,[t,...i]){for(let r of n)if("children"in r&&t===r.name)return i.length?e(r.children,i):r})(x.pageMap,e).children=t}if(n){let{title:e,frontMatter:t}=n;x={...x,title:e,frontMatter:t}}return(0,i.jsx)(c,{themeConfig:a,pageOpts:x,pageProps:t,children:(0,i.jsx)(d,{value:t,children:(0,i.jsx)(h,{useTOC:j,children:(0,i.jsx)(m,{...t})})})})}function h({children:e,useTOC:n}){let{wrapper:t}=(0,c.R)();return(0,i.jsx)(u,{useTOC:n,wrapper:t,children:e})}function u({children:e,useTOC:n,wrapper:t,...r}){let l=n(r);return t?(0,i.jsx)(t,{toc:l,children:e}):e}}},e=>{var n=n=>e(e.s=n);e.O(0,[1781,636,6593,8792],()=>n(55420)),_N_E=e.O()}]);
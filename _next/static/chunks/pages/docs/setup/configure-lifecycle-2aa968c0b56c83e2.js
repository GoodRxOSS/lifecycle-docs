(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5433],{1513:(e,n,t)=>{"use strict";t.d(n,{R:()=>r});var o=t(91668),s=t(54587),l=t.n(s),i=t(14232);let a={img:e=>(0,i.createElement)("object"==typeof e.src?l():"img",e)},r=e=>(0,o.R)({...a,...e})},60474:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/setup/configure-lifecycle",function(){return t(78920)}])},71807:(e,n,t)=>{"use strict";t.d(n,{e:()=>c});var o=t(37876),s=t(20181),l=t(27096);let i=(0,t(14232).createContext)({}),a=i.Provider;i.displayName="SSG";var r=t(1513);function c(e,n,t,o){let l=globalThis[s.VZ];return l.route=n,l.pageMap=t.pageMap,l.context[n]={Content:e,pageOpts:t,useTOC:o},d}function d({__nextra_pageMap:e=[],__nextra_dynamic_opts:n,...t}){let i=globalThis[s.VZ],{Layout:r,themeConfig:c}=i,{route:d,locale:p}=(0,l.r)(),u=i.context[d];if(!u)throw Error(`No content found for the "${d}" route. Please report it as a bug.`);let{pageOpts:f,useTOC:F,Content:g}=u;if(d.startsWith("/["))f.pageMap=e;else for(let{route:n,children:t}of e){let e=n.split("/").slice(p?2:1);(function e(n,[t,...o]){for(let s of n)if("children"in s&&t===s.name)return o.length?e(s.children,o):s})(f.pageMap,e).children=t}if(n){let{title:e,frontMatter:t}=n;f={...f,title:e,frontMatter:t}}return(0,o.jsx)(r,{themeConfig:c,pageOpts:f,pageProps:t,children:(0,o.jsx)(a,{value:t,children:(0,o.jsx)(h,{useTOC:F,children:(0,o.jsx)(g,{...t})})})})}function h({children:e,useTOC:n}){let{wrapper:t}=(0,r.R)();return(0,o.jsx)(p,{useTOC:n,wrapper:t,children:e})}function p({children:e,useTOC:n,wrapper:t,...s}){let l=n(s);return t?(0,o.jsx)(t,{toc:l,children:e}):e}},78920:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>c,useTOC:()=>r});var o=t(37876),s=t(71807),l=t(1781),i=t(1513),a=t(19941);function r(e){return[{value:"Set Default IP Whitelist",id:"set-default-ip-whitelist",depth:2},{value:"Enable Environment Lens Globally",id:"enable-environment-lens-globally",depth:2},{value:"Refresh config cache",id:"refresh-config-cache",depth:2}]}let c=(0,s.e)(function(e){let{toc:n=r(e)}=e,t={a:"a",code:"code",h2:"h2",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Code:s}=t;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Code",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"We are in the final step of the setup process."}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"This step is Optional but highly recommended to ensure the default IP Whitelist is set for the environments created by the Lifecycle app."})," This will help in securing the environments and restricting access to only the specified IPs or CIDR blocks."]}),"\n",(0,o.jsx)(t.h2,{id:n[0].id,children:n[0].value}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Connect to the ",(0,o.jsx)(t.code,{children:"postgres"})," database using the ",(0,o.jsx)(t.code,{children:"psql"})," command line tool or any other database client."]}),"\n",(0,o.jsx)(a.P,{type:"info",children:(0,o.jsxs)(t.p,{children:["Database password was auto generated during the infra setup and can be found\nretrieved from the ",(0,o.jsx)(t.code,{children:"app-postgres"})," secret in the ",(0,o.jsx)(t.code,{children:"lifecycle-app"}),"\nnamespace."]})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Retrieve the database password:"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s,{codeblock:{value:"   kubectl get secret app-postgres --namespace lifecycle-app \\\n      -o jsonpath='{.data}' | jq 'with_entries(.value |= @base64d)'",lang:"shellscript",meta:"",code:"   kubectl get secret app-postgres --namespace lifecycle-app \\\n      -o jsonpath='{.data}' | jq 'with_entries(.value |= @base64d)'",tokens:["   ",["kubectl","#FFA657"]," ",["get secret app-postgres","#A5D6FF"]," ",["--namespace","#79C0FF"]," ",["lifecycle-app","#A5D6FF"]," ",["\\","#79C0FF"],"\n      ",["-o","#79C0FF"]," ",["jsonpath='{.data}'","#A5D6FF"]," ",["|","#FF7B72"]," ",["jq","#FFA657"]," ",["'with_entries(.value |= @base64d)'","#A5D6FF"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Run the following SQL commands to update the configuration:"}),"\n"]}),"\n",(0,o.jsx)(s,{codeblock:{value:'-- provide a default IP whitelist for the environments, default is open to all IPs\nUPDATE public.global_config\nSET\n    config = (\n        config::jsonb ||\n        \'{\n            "defaultIPWhiteList": "{ 0.0.0.0/0 }"\n         }\'::jsonb\n    )::json,\n    "updatedAt" = NOW()\nWHERE "key" = \'serviceDefaults\';',lang:"sql",meta:"",code:'-- provide a default IP whitelist for the environments, default is open to all IPs\nUPDATE public.global_config\nSET\n    config = (\n        config::jsonb ||\n        \'{\n            "defaultIPWhiteList": "{ 0.0.0.0/0 }"\n         }\'::jsonb\n    )::json,\n    "updatedAt" = NOW()\nWHERE "key" = \'serviceDefaults\';',tokens:[["-- provide a default IP whitelist for the environments, default is open to all IPs","#8B949E"],"\n",["UPDATE","#FF7B72"]," ",["public","#79C0FF"],[".","#C9D1D9"],["global_config","#79C0FF"],"\n",["SET","#FF7B72"],"\n    ",["config","#C9D1D9"]," ",["=","#FF7B72"]," ",["(","#C9D1D9"],"\n        ",["config::jsonb","#C9D1D9"]," ",["||","#FF7B72"],"\n        ",["'{","#A5D6FF"],"\n            ",['"defaultIPWhiteList": "{ 0.0.0.0/0 }"',"#A5D6FF"],"\n         ",["}'","#A5D6FF"],["::jsonb","#C9D1D9"],"\n    ",[")::","#C9D1D9"],["json","#FF7B72"],[",","#C9D1D9"],"\n    ",['"updatedAt"',"#A5D6FF"]," ",["= NOW","#FF7B72"],["()","#C9D1D9"],"\n",["WHERE","#FF7B72"]," ",['"key"',"#A5D6FF"]," ",["=","#FF7B72"]," ",["'serviceDefaults'","#A5D6FF"],[";","#C9D1D9"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,o.jsxs)(a.P,{type:"error",emoji:"⚠️",children:[(0,o.jsxs)(t.p,{children:["Note that the infra setup with the OpenTofu modules below will ",(0,o.jsx)(t.strong,{children:"open your\ncluster to the world."})," ",(0,o.jsx)("br",{}),"\n\uD83D\uDEE1️ Make sure to ",(0,o.jsx)(t.strong,{children:(0,o.jsx)("a",{href:"https://translate.google.com/details?sl=auto&tl=hy&text=shield&op=translate",children:"shield"})})," your cluster by implementing appropriate network policies\nand access controls after the initial setup."]}),(0,o.jsxs)(t.p,{children:["Replace the ",(0,o.jsx)(t.code,{children:"defaultIPWhiteList"})," under ",(0,o.jsx)(t.code,{children:"global_config.serviceDefaults"})," with your actual IP whitelist or CIDR block to restrict access to the deployed environments."]})]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:n[1].id,children:n[1].value}),"\n",(0,o.jsxs)(t.p,{children:["The environment lens banner can be enabled globally for all services via the ",(0,o.jsx)(t.code,{children:"features"})," row in ",(0,o.jsx)(t.code,{children:"global_config"}),". Individual services can still override this by setting ",(0,o.jsx)(t.code,{children:"envLens"})," explicitly in their ",(0,o.jsx)(t.code,{children:"lifecycle.yaml"}),"."]}),"\n",(0,o.jsx)(s,{codeblock:{value:'-- Enable envLens globally for all services\nINSERT INTO public.global_config ("key", config, "createdAt", "updatedAt")\nVALUES (\'features\', \'{"envLens": true}\'::json, NOW(), NOW())\nON CONFLICT ("key")\nDO UPDATE SET\n    config = (public.global_config.config::jsonb || \'{"envLens": true}\'::jsonb)::json,\n    "updatedAt" = NOW();',lang:"sql",meta:"",code:'-- Enable envLens globally for all services\nINSERT INTO public.global_config ("key", config, "createdAt", "updatedAt")\nVALUES (\'features\', \'{"envLens": true}\'::json, NOW(), NOW())\nON CONFLICT ("key")\nDO UPDATE SET\n    config = (public.global_config.config::jsonb || \'{"envLens": true}\'::jsonb)::json,\n    "updatedAt" = NOW();',tokens:[["-- Enable envLens globally for all services","#8B949E"],"\n",["INSERT INTO","#FF7B72"]," ",["public","#79C0FF"],[".","#C9D1D9"],["global_config","#79C0FF"]," ",["(","#C9D1D9"],['"key"',"#A5D6FF"],[", config,","#C9D1D9"]," ",['"createdAt"',"#A5D6FF"],[",","#C9D1D9"]," ",['"updatedAt"',"#A5D6FF"],[")","#C9D1D9"],"\n",["VALUES","#FF7B72"]," ",["(","#C9D1D9"],["'features'","#A5D6FF"],[",","#C9D1D9"]," ",["'{\"envLens\": true}'","#A5D6FF"],["::","#C9D1D9"],["json","#FF7B72"],[",","#C9D1D9"]," ",["NOW","#FF7B72"],["(),","#C9D1D9"]," ",["NOW","#FF7B72"],["())","#C9D1D9"],"\n",["ON","#FF7B72"]," ",["CONFLICT (","#C9D1D9"],['"key"',"#A5D6FF"],[")","#C9D1D9"],"\n",["DO","#C9D1D9"]," ",["UPDATE SET","#FF7B72"],"\n    ",["config","#C9D1D9"]," ",["=","#FF7B72"]," ",["(","#C9D1D9"],["public","#79C0FF"],[".","#C9D1D9"],["global_config","#79C0FF"],[".config::jsonb","#C9D1D9"]," ",["||","#FF7B72"]," ",["'{\"envLens\": true}'","#A5D6FF"],["::jsonb)::","#C9D1D9"],["json","#FF7B72"],[",","#C9D1D9"],"\n    ",['"updatedAt"',"#A5D6FF"]," ",["= NOW","#FF7B72"],["();","#C9D1D9"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,o.jsxs)(t.p,{children:["After running this, ",(0,o.jsx)(t.a,{href:"#refresh-config-cache",children:"refresh the config cache"})," to apply the change."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:n[2].id,children:n[2].value}),"\n",(0,o.jsx)(s,{codeblock:{value:"curl -X PUT https://app.<your_domain>/api/v1/config/cache",lang:"shellscript",meta:"",code:"curl -X PUT https://app.<your_domain>/api/v1/config/cache",tokens:[["curl","#FFA657"]," ",["-X","#79C0FF"]," ",["PUT https://app.","#A5D6FF"],["<","#FF7B72"],["your_domai","#A5D6FF"],["n","#C9D1D9"],[">","#FF7B72"],["/api/v1/config/cache","#A5D6FF"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,o.jsx)(t.p,{children:"This will refresh the configuration cache and apply the changes you made to the database for the Lifecycle app."}),"\n",(0,o.jsx)(t.p,{children:"We are all set! \uD83C\uDF89 And ready to create our first PR based ephemeral environment."})]})},"/docs/setup/configure-lifecycle",{filePath:"src/pages/docs/setup/configure-lifecycle.mdx",timestamp:177162007e4,pageMap:l.O,frontMatter:{title:"Additional Configuration",tags:["configure","lifecycle","install","setup"]},title:"Additional Configuration"},"undefined"==typeof RemoteContent?r:RemoteContent.useTOC)}},e=>{var n=n=>e(e.s=n);e.O(0,[1781,636,6593,8792],()=>n(60474)),_N_E=e.O()}]);
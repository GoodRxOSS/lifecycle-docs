(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6348],{1513:(e,n,t)=>{"use strict";t.d(n,{R:()=>a});var i=t(1668),o=t(4587),s=t.n(o),l=t(4232);let c={img:e=>(0,l.createElement)("object"==typeof e.src?s():"img",e)},a=e=>(0,i.R)({...c,...e})},1807:(e,n,t)=>{"use strict";t.d(n,{e:()=>r});var i=t(7876),o=t(181),s=t(7096);let l=(0,t(4232).createContext)({}),c=l.Provider;l.displayName="SSG";var a=t(1513);function r(e,n,t,i){let s=globalThis[o.VZ];return s.route=n,s.pageMap=t.pageMap,s.context[n]={Content:e,pageOpts:t,useTOC:i},d}function d({__nextra_pageMap:e=[],__nextra_dynamic_opts:n,...t}){let l=globalThis[o.VZ],{Layout:a,themeConfig:r}=l,{route:d,locale:u}=(0,s.r)(),h=l.context[d];if(!h)throw Error(`No content found for the "${d}" route. Please report it as a bug.`);let{pageOpts:F,useTOC:E,Content:b}=h;if(d.startsWith("/["))F.pageMap=e;else for(let{route:n,children:t}of e){let e=n.split("/").slice(u?2:1);(function e(n,[t,...i]){for(let o of n)if("children"in o&&t===o.name)return i.length?e(o.children,i):o})(F.pageMap,e).children=t}if(n){let{title:e,frontMatter:t}=n;F={...F,title:e,frontMatter:t}}return(0,i.jsx)(a,{themeConfig:r,pageOpts:F,pageProps:t,children:(0,i.jsx)(c,{value:t,children:(0,i.jsx)(p,{useTOC:E,children:(0,i.jsx)(b,{...t})})})})}function p({children:e,useTOC:n}){let{wrapper:t}=(0,a.R)();return(0,i.jsx)(u,{useTOC:n,wrapper:t,children:e})}function u({children:e,useTOC:n,wrapper:t,...o}){let s=n(o);return t?(0,i.jsx)(t,{toc:s,children:e}):e}},7756:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/setup/create-github-app",function(){return t(7981)}])},7981:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>d,useTOC:()=>r});var i=t(7876),o=t(1807),s=t(4674),l=t(1513),c=t(9941),a=t(9471);function r(e){return[{value:"Configure BuildKit Endpoint",id:"configure-buildkit-endpoint",depth:2},{value:"Option 1: Using kubectl exec with psql",id:"option-1-using-kubectl-exec-with-psql",depth:3},{value:"Option 2: Direct SQL query",id:"option-2-direct-sql-query",depth:3},{value:"Refresh Configuration Cache",id:"refresh-configuration-cache",depth:3},{value:"Create GitHub App",id:"create-github-app",depth:2}]}let d=(0,o.e)(function(e){let{toc:n=r(e)}=e,t={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Code:o}=t;return o||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Code",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:n[0].id,children:n[0].value}),"\n",(0,i.jsx)(t.p,{children:"Before creating the GitHub app, you need to configure the BuildKit endpoint in the database:"}),"\n",(0,i.jsx)(c.P,{type:"warning",children:(0,i.jsxs)(t.p,{children:["Set the ",(0,i.jsx)(t.code,{children:"HELM_RELEASE"})," environment variable to your actual Helm release name\nbefore running the commands below."]})}),"\n",(0,i.jsx)(c.P,{type:"info",children:(0,i.jsxs)(t.p,{children:["The following commands will create the ",(0,i.jsx)(t.code,{children:"buildkit"})," object and ",(0,i.jsx)(t.code,{children:"endpoint"}),"\nconfiguration if they don’t exist, or update them if they do."]})}),"\n",(0,i.jsx)(t.h3,{id:n[1].id,children:n[1].value}),"\n",(0,i.jsx)(t.p,{children:"Execute the following commands to connect to the PostgreSQL pod and run the query:"}),"\n",(0,i.jsx)(o,{codeblock:{value:"# Set your Helm release name (replace with your actual release name)\nexport HELM_RELEASE=<YOUR-HELM-RELEASE>\n\n# Get the database password from the secret\nexport PGPASSWORD=$(kubectl get secret ${HELM_RELEASE}-postgres -n lifecycle-app -o jsonpath='{.data.POSTGRES_USER_PASSWORD}' | base64 -d)\n\n# Run the query\nkubectl exec -it ${HELM_RELEASE}-postgres-0 -n lifecycle-app -- env PGPASSWORD=$PGPASSWORD psql -U lifecycle -d lifecycle -c \"\nUPDATE global_config\nSET config = jsonb_set(\n    jsonb_set(\n        COALESCE(config::jsonb, '{}'::jsonb),\n        '{buildkit}',\n        COALESCE(config::jsonb->'buildkit', '{}'::jsonb),\n        true\n    ),\n    '{buildkit,endpoint}',\n    '\\\"tcp://${HELM_RELEASE}-buildkit.lifecycle-app.svc.cluster.local:1234\\\"'::jsonb,\n    true\n),\n\\\"updatedAt\\\" = NOW()\nWHERE key = 'buildDefaults';\"",lang:"shellscript",meta:"",code:"# Set your Helm release name (replace with your actual release name)\nexport HELM_RELEASE=<YOUR-HELM-RELEASE>\n\n# Get the database password from the secret\nexport PGPASSWORD=$(kubectl get secret ${HELM_RELEASE}-postgres -n lifecycle-app -o jsonpath='{.data.POSTGRES_USER_PASSWORD}' | base64 -d)\n\n# Run the query\nkubectl exec -it ${HELM_RELEASE}-postgres-0 -n lifecycle-app -- env PGPASSWORD=$PGPASSWORD psql -U lifecycle -d lifecycle -c \"\nUPDATE global_config\nSET config = jsonb_set(\n    jsonb_set(\n        COALESCE(config::jsonb, '{}'::jsonb),\n        '{buildkit}',\n        COALESCE(config::jsonb->'buildkit', '{}'::jsonb),\n        true\n    ),\n    '{buildkit,endpoint}',\n    '\\\"tcp://${HELM_RELEASE}-buildkit.lifecycle-app.svc.cluster.local:1234\\\"'::jsonb,\n    true\n),\n\\\"updatedAt\\\" = NOW()\nWHERE key = 'buildDefaults';\"",tokens:[["# Set your Helm release name (replace with your actual release name)","#8B949E"],"\n",["export","#FF7B72"]," ",["HELM_RELEASE","#C9D1D9"],["=<","#FF7B72"],["YOUR-HELM-RELEASE","#C9D1D9"],[">","#FF7B72"],"\n\n",["# Get the database password from the secret","#8B949E"],"\n",["export","#FF7B72"]," ",["PGPASSWORD","#C9D1D9"],["=","#FF7B72"],["$(","#C9D1D9"],["kubectl","#FFA657"]," ",["get secret","#A5D6FF"]," ",["${HELM_RELEASE}","#C9D1D9"],["-postgres","#A5D6FF"]," ",["-n","#79C0FF"]," ",["lifecycle-app","#A5D6FF"]," ",["-o","#79C0FF"]," ",["jsonpath='{.data.POSTGRES_USER_PASSWORD}'","#A5D6FF"]," ",["|","#FF7B72"]," ",["base64","#FFA657"]," ",["-d","#79C0FF"],[")","#C9D1D9"],"\n\n",["# Run the query","#8B949E"],"\n",["kubectl","#FFA657"]," ",["exec","#A5D6FF"]," ",["-it","#79C0FF"]," ",["${HELM_RELEASE}","#C9D1D9"],["-postgres-0","#A5D6FF"]," ",["-n","#79C0FF"]," ",["lifecycle-app","#A5D6FF"]," ",["--","#79C0FF"]," ",["env PGPASSWORD=","#A5D6FF"],["$PGPASSWORD","#C9D1D9"]," ",["psql","#A5D6FF"]," ",["-U","#79C0FF"]," ",["lifecycle","#A5D6FF"]," ",["-d","#79C0FF"]," ",["lifecycle","#A5D6FF"]," ",["-c","#79C0FF"]," ",['"',"#A5D6FF"],"\n",["UPDATE global_config","#A5D6FF"],"\n",["SET config = jsonb_set(","#A5D6FF"],"\n    ",["jsonb_set(","#A5D6FF"],"\n        ",["COALESCE(config::jsonb, '{}'::jsonb),","#A5D6FF"],"\n        ",["'{buildkit}',","#A5D6FF"],"\n        ",["COALESCE(config::jsonb->'buildkit', '{}'::jsonb),","#A5D6FF"],"\n        ",["true","#A5D6FF"],"\n    ",["),","#A5D6FF"],"\n    ",["'{buildkit,endpoint}',","#A5D6FF"],"\n    ",["'","#A5D6FF"],['\\"',"#79C0FF"],["tcp://${","#A5D6FF"],["HELM_RELEASE","#C9D1D9"],["}-buildkit.lifecycle-app.svc.cluster.local:1234","#A5D6FF"],['\\"',"#79C0FF"],["'::jsonb,","#A5D6FF"],"\n    ",["true","#A5D6FF"],"\n",["),","#A5D6FF"],"\n",['\\"',"#79C0FF"],["updatedAt","#A5D6FF"],['\\"',"#79C0FF"]," ",["= NOW()","#A5D6FF"],"\n",["WHERE key = 'buildDefaults';\"","#A5D6FF"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,i.jsx)(t.h3,{id:n[2].id,children:n[2].value}),"\n",(0,i.jsxs)(t.p,{children:["If you have direct database access, run the following SQL query (replace ",(0,i.jsx)(t.code,{children:"<YOUR-HELM-RELEASE>"})," with your actual Helm release name):"]}),"\n",(0,i.jsx)(o,{codeblock:{value:"UPDATE global_config\nSET config = jsonb_set(\n    jsonb_set(\n        COALESCE(config::jsonb, '{}'::jsonb),\n        '{buildkit}',\n        COALESCE(config::jsonb->'buildkit', '{}'::jsonb),\n        true\n    ),\n    '{buildkit,endpoint}',\n    '\"tcp://<YOUR-HELM-RELEASE>-buildkit.lifecycle-app.svc.cluster.local:1234\"'::jsonb,\n    true\n),\n\"updatedAt\" = NOW()\nWHERE key = 'buildDefaults';",lang:"sql",meta:"",code:"UPDATE global_config\nSET config = jsonb_set(\n    jsonb_set(\n        COALESCE(config::jsonb, '{}'::jsonb),\n        '{buildkit}',\n        COALESCE(config::jsonb->'buildkit', '{}'::jsonb),\n        true\n    ),\n    '{buildkit,endpoint}',\n    '\"tcp://<YOUR-HELM-RELEASE>-buildkit.lifecycle-app.svc.cluster.local:1234\"'::jsonb,\n    true\n),\n\"updatedAt\" = NOW()\nWHERE key = 'buildDefaults';",tokens:[["UPDATE","#FF7B72"]," ",["global_config","#C9D1D9"],"\n",["SET","#FF7B72"]," ",["config","#C9D1D9"]," ",["=","#FF7B72"]," ",["jsonb_set(","#C9D1D9"],"\n    ",["jsonb_set(","#C9D1D9"],"\n        ",["COALESCE","#79C0FF"],["(config::jsonb,","#C9D1D9"]," ",["'{}'","#A5D6FF"],["::jsonb),","#C9D1D9"],"\n        ",["'{buildkit}'","#A5D6FF"],[",","#C9D1D9"],"\n        ",["COALESCE","#79C0FF"],["(config::jsonb","#C9D1D9"],["->","#FF7B72"],["'buildkit'","#A5D6FF"],[",","#C9D1D9"]," ",["'{}'","#A5D6FF"],["::jsonb),","#C9D1D9"],"\n        ",["true","#C9D1D9"],"\n    ",["),","#C9D1D9"],"\n    ",["'{buildkit,endpoint}'","#A5D6FF"],[",","#C9D1D9"],"\n    ",["'\"tcp://<YOUR-HELM-RELEASE>-buildkit.lifecycle-app.svc.cluster.local:1234\"'","#A5D6FF"],["::jsonb,","#C9D1D9"],"\n    ",["true","#C9D1D9"],"\n",["),","#C9D1D9"],"\n",['"updatedAt"',"#A5D6FF"]," ",["= NOW","#FF7B72"],["()","#C9D1D9"],"\n",["WHERE key =","#FF7B72"]," ",["'buildDefaults'","#A5D6FF"],[";","#C9D1D9"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,i.jsx)(t.h3,{id:n[3].id,children:n[3].value}),"\n",(0,i.jsx)(t.p,{children:"After running either option above, refresh the configuration cache:"}),"\n",(0,i.jsx)(o,{codeblock:{value:"curl -X 'PUT' \\\n  'https://app.<your_domain>/api/v1/config/cache' \\\n  -H 'accept: application/json'",lang:"shellscript",meta:"",code:"curl -X 'PUT' \\\n  'https://app.<your_domain>/api/v1/config/cache' \\\n  -H 'accept: application/json'",tokens:[["curl","#FFA657"]," ",["-X","#79C0FF"]," ",["'PUT'","#A5D6FF"]," ",["\\","#79C0FF"],"\n  ",["'https://app.<your_domain>/api/v1/config/cache'","#A5D6FF"]," ",["\\","#79C0FF"],"\n  ",["-H","#79C0FF"]," ",["'accept: application/json'","#A5D6FF"]],annotations:[],themeName:"github-dark",style:{color:"#c9d1d9",background:"#0d1117",colorScheme:"dark"}}}),"\n",(0,i.jsxs)(t.p,{children:["Replace ",(0,i.jsx)(t.code,{children:"<your_domain>"})," with your actual domain (e.g., ",(0,i.jsx)(t.code,{children:"0env.com"}),")."]}),"\n",(0,i.jsx)(t.h2,{id:n[4].id,children:n[4].value}),"\n",(0,i.jsx)(t.p,{children:"To create a Github app that will send events to the Lifecycle with necessary permissions, follow these steps:"}),"\n",(0,i.jsx)(c.P,{type:"info",children:(0,i.jsx)(t.p,{children:"Make sure you have admin access to the Github organization or account where\nyou want to create the app."})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Navigate to your installed Lifecycle app at ",(0,i.jsx)(t.code,{children:"https://app.<your_domain>/setup"})," (replace ",(0,i.jsx)(t.code,{children:"<your_domain>"})," with your actual domain. e.g. ",(0,i.jsx)(t.code,{children:"https://app.0env.com/setup"}),")."]}),"\n",(0,i.jsx)(a._V,{src:"/setup/github-app-setup.png",width:1872,height:1068}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Select ",(0,i.jsx)(t.code,{children:"Personal"})," or ",(0,i.jsx)(t.code,{children:"Organization"})," based on your needs."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Fill in the required fields:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Github App Name"}),": A name for your app. (should be unique, use a prefix with your name or organization. Refer Github app naming convention ",(0,i.jsx)(t.a,{href:"https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/",children:"here"})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Organization Name"}),": Github organization name where the app will be created. Required if you selected ",(0,i.jsx)(t.code,{children:"Organization"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Click ",(0,i.jsx)(t.code,{children:"Create App"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["On the Github app creation page, confirm the app name and click ",(0,i.jsx)(t.code,{children:"Create"})]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Once the app is created, you will be redirected to the app installation page where you can choose one or more repositories to install the the newly minted app."}),"\n",(0,i.jsx)(c.P,{type:"info",children:(0,i.jsxs)(t.p,{children:["Make sure to select the repositories you want the app to have access to. You\ncan always change this later in the app settings but ",(0,i.jsx)(t.strong,{children:"adding atleast one\nrepository is required to proceed with the setup"}),"."]})}),"\n",(0,i.jsx)("br",{}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Voila! \uD83C\uDF89 Your Github app is now created and installed."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(a._V,{src:"/setup/github-app-installed.png",width:1902,height:1088}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Click ",(0,i.jsx)(t.code,{children:"Configure and Restart"})," to apply the changes and start using the app."]}),"\n"]}),"\n",(0,i.jsx)(c.P,{type:"info",children:(0,i.jsxs)(t.p,{children:["The step above, sets up the global config values that Lifecycle app will use\ncreating ephemeral environments and processing pull requests. And restarts the\n",(0,i.jsx)(t.code,{children:"deployment"})," for the github app secrets to take effect."]})}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.p,{children:"Let’s move on the final step where we will configure the Lifecycle app config for processing pull requests and creating ephemeral environments."})]})},"/docs/setup/create-github-app",{filePath:"src/pages/docs/setup/create-github-app.mdx",timestamp:1757554733e3,pageMap:s.O,frontMatter:{title:"Configure Application",tags:["github","app","install","setup"]},title:"Configure Application"},"undefined"==typeof RemoteContent?r:RemoteContent.useTOC)}},e=>{var n=n=>e(e.s=n);e.O(0,[4674,636,6593,8792],()=>n(7756)),_N_E=e.O()}]);
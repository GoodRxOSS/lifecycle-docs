---
title: Setup your cluster
tags:
  - cluster
  - setup
  - gke
  - aws
---

import { Callout } from "nextra/components";
import { Info, Cog } from "lucide-react";
import { Cards } from "nextra/components";
import { Mermaid } from "@lifecycle-docs/components";

## Quick Reference

| Provider | Cluster Type | DNS Options                    | Required Permissions    |
| -------- | ------------ | ------------------------------ | ----------------------- |
| GCP      | GKE          | cloud-dns, cloudflare, route53 | Project Owner or Editor |
| AWS      | EKS          | route53, cloudflare, cloud-dns | AdministratorAccess     |

<Callout type="error" emoji="">
  **Security Warning:** This setup opens your cluster to the internet. Implement
  network policies and access controls after initial setup.
</Callout>

## Setup Overview

<Mermaid
  chart={`
flowchart LR
    A[Configure credentials\nGCP/AWS] --> B[Clone\nlifecycle-opentofu repo]
    B --> C[Configure\nsecrets.auto.tfvars]
    C --> D[tofu init]
    D --> E[tofu plan]
    E --> F[tofu apply]
    F --> G[Verify with curl\nhttps://kuard.YOUR_DOMAIN]
`}
/>

**Resources created:** Kubernetes cluster, DNS records, database, Redis, and supporting infrastructure.

---

## Google Cloud Platform

### 1. Configure Credentials

```sh
gcloud config set project <PROJECT_ID>
gcloud auth application-default login
gcloud services enable container.googleapis.com dns.googleapis.com --project=<PROJECT_ID>
```

<Callout type="info" icon={Info}>
  Use your Google Cloud **project ID** (not project name).
</Callout>

### 2. Deploy Infrastructure

```sh
git clone https://github.com/GoodRxOSS/lifecycle-opentofu/ && cd lifecycle-opentofu
cp example.auto.tfvars secrets.auto.tfvars
```

Edit `secrets.auto.tfvars`:

```hcl secrets.auto.tfvars
gcp_project          = "<PROJECT_ID>"
gcp_region           = "<REGION>"
gcp_credentials_file = "~/.config/gcloud/application_default_credentials.json"
cluster_provider     = "gke"
dns_provider         = "cloud-dns"     # Options: cloudflare, route53, cloud-dns
app_domain           = "<YOUR_DOMAIN>" # e.g., 0env.com
cluster_name         = "lifecycle-gke"
app_namespace        = "lifecycle-app"
```

```sh
tofu init && tofu plan && tofu apply
```

### 3. Verify Setup

```sh
curl -v https://kuard.<YOUR_DOMAIN>
```

See [example output](https://github.com/GoodRxOSS/lifecycle-opentofu/?tab=readme-ov-file#4-initialize--apply) for kubeconfig setup.

<br />
<Cards.Card
  icon={<Cog />}
  title="Install Lifecycle"
  href="/docs/setup/install-lifecycle"
  arrow
/>

---

## Amazon Web Services

### 1. Configure Credentials

```sh
aws configure --profile lifecycle-oss-eks
```

Enter your Access Key ID, Secret Access Key, Region, and output format when prompted.

<Callout type="info" icon={Info}>
  Profile requires **AdministratorAccess** permissions.
</Callout>

### 2. Deploy Infrastructure

```sh
git clone https://github.com/GoodRxOSS/lifecycle-opentofu/ && cd lifecycle-opentofu
cp example.auto.tfvars secrets.auto.tfvars
```

Edit `secrets.auto.tfvars`:

```hcl secrets.auto.tfvars
aws_region           = "<REGION>"
cluster_provider     = "eks"
dns_provider         = "route53"       # Options: cloudflare, route53, cloud-dns
app_domain           = "<YOUR_DOMAIN>" # e.g., 0env.com
cluster_name         = "lifecycle-eks"
app_namespace        = "lifecycle-app"
```

```sh
tofu init && tofu plan && tofu apply
```

### 3. Verify Setup

```sh
curl -v https://kuard.<YOUR_DOMAIN>
```

See [example output](https://github.com/GoodRxOSS/lifecycle-opentofu/?tab=readme-ov-file#4-initialize--apply) for kubeconfig setup.

<br />
<Cards.Card
  icon={<Cog />}
  title="Install Lifecycle"
  href="/docs/setup/install-lifecycle"
  arrow
/>

---

## Troubleshooting

| Problem                                  | Solution                                                                                   |
| ---------------------------------------- | ------------------------------------------------------------------------------------------ |
| `tofu apply` fails with permission error | Verify credentials have required permissions (GCP: Owner/Editor, AWS: AdministratorAccess) |
| DNS not resolving                        | Wait 5-10 minutes for propagation; verify domain ownership                                 |
| `curl` returns connection refused        | Check cluster ingress controller is running: `kubectl get pods -n ingress-nginx`           |
| kuard not accessible                     | Verify DNS records in your provider's console                                              |

---

## Setup Checklist

- [ ] Cloud credentials configured
- [ ] Required APIs/services enabled
- [ ] `secrets.auto.tfvars` configured with your values
- [ ] `tofu apply` completed successfully
- [ ] `curl https://kuard.<YOUR_DOMAIN>` returns a response
- [ ] kubeconfig configured for cluster access
- [ ] Network policies reviewed for security

---
title: Configure environment
tags:
  - tutorial
  - configure
  - edit
---

import { Callout } from "nextra/components";
import { Mermaid } from "@lifecycle-docs/components";

Learn how to customize your Lifecycle environment by configuring services and dependencies.

## Quick Reference

| Option             | Purpose                       | Default                  |
| ------------------ | ----------------------------- | ------------------------ |
| `autoDeploy`       | Auto-deploy on PR open/update | `true`                   |
| `defaultServices`  | Always built and deployed     | Required                 |
| `optionalServices` | Built on demand only          | Falls back to static env |
| `defaultUUID`      | Static environment fallback   | `dev-0`                  |
| `requires`         | Service dependencies          | None                     |

## Configuration File Structure

<Mermaid chart={`
flowchart TB
    root["lifecycle.yaml"]
    env["environment"]
    autoDeploy["autoDeploy<br/><i>true/false</i>"]
    defaultServices["defaultServices<br/><i>Always deployed</i>"]
    optionalServices["optionalServices<br/><i>On-demand only</i>"]
    services["services[]"]
    name["name"]
    defaultUUID["defaultUUID<br/><i>Fallback static env</i>"]
    requires["requires[]<br/><i>Dependencies</i>"]
    github["github"]
    docker["docker"]
    dockerEnv["env<br/><i>Template variables</i>"]

    root --> env
    root --> services
    env --> autoDeploy
    env --> defaultServices
    env --> optionalServices
    services --> name
    services --> defaultUUID
    services --> requires
    services --> github
    github --> docker
    docker --> dockerEnv

`} />

### Example Configuration

```yaml filename="lifecycle.yaml"
environment:
  autoDeploy: true
  defaultServices:
    - name: "frontend"
    - name: "backend"
  optionalServices:
    - name: "cache"

services:
  - name: "frontend"
    defaultUUID: "dev-0"
    github:
      repository: "iceycake/lifecycle-examples"
      branchName: "main"
      docker:
        builder:
          engine: "buildkit"
        defaultTag: "main"
        app:
          dockerfilePath: "Dockerfile.frontend"
          ports:
            - 3000
          env:
            API_URL: "https://{{{backend_publicUrl}}}"
            CACHE_URL: "{{{cache_internalHostname}}}"
  - name: "backend"
    requires:
      - name: "db"
    defaultUUID: "dev-0"
    # ...
```

## Service Types

| Type         | Behavior                  | Use Case                                  |
| ------------ | ------------------------- | ----------------------------------------- |
| **Default**  | Always built and deployed | Core services (frontend, backend)         |
| **Optional** | Built only when selected  | Non-critical services (cache, monitoring) |

**Optional services** use a static environment (`dev-0`) as fallback when not explicitly enabled.

## Template Variables

Template variables are dynamically resolved at build and deploy time:

```yaml
env:
  API_URL: "https://{{{backend_publicUrl}}}"
  CACHE_URL: "{{{cache_internalHostname}}}"
```

**Resulting values:**

| Variable    | When Optional NOT Selected                | When Optional Selected                      |
| ----------- | ----------------------------------------- | ------------------------------------------- |
| `API_URL`   | `https://backend-<uuid>.<domain>`         | `https://backend-<uuid>.<domain>`           |
| `CACHE_URL` | `cache-dev-0.env-dev-0.svc.cluster.local` | `cache-<uuid>.env-<uuid>.svc.cluster.local` |

<Callout type="info">
  See all supported template variables in the [Template Variables
  guide](/docs/features/template-variables).
</Callout>

## Auto Deploy

| Setting             | Behavior                                       |
| ------------------- | ---------------------------------------------- |
| `autoDeploy: true`  | Builds trigger automatically on PR open/update |
| `autoDeploy: false` | Requires `lifecycle-deploy!` label to trigger  |

## Service Dependencies

Use `requires` to declare dependencies:

```yaml
services:
  - name: "backend"
    requires:
      - name: "db"
```

Lifecycle automatically:

1. Resolves the dependency graph
2. Builds services in correct order
3. Ensures dependencies are running before dependents start

## Enable Optional Services

To enable an optional service (e.g., `cache`):

1. Go to the **Lifecycle PR comment** on GitHub
2. Check the service checkbox
3. Wait for build to complete

Verify by checking your app's Variables page - the URL should now include your environment UUID instead of `dev-0`.

<Callout type="info">
  Learn more about the PR interface in [Using Mission
  Control](/docs/tips/using-mission-control).
</Callout>

## Troubleshooting

| Problem                           | Solution                                                    |
| --------------------------------- | ----------------------------------------------------------- |
| Optional service using static env | Enable service checkbox in PR comment                       |
| Deployment not triggering         | Check `autoDeploy` setting or add `lifecycle-deploy!` label |
| Service failing to start          | Verify all `requires` dependencies are enabled              |
| Wrong template variable value     | Confirm service is enabled and built successfully           |

## Checklist

- [ ] `defaultServices` includes all core services
- [ ] `optionalServices` includes on-demand services
- [ ] `autoDeploy` set according to team workflow
- [ ] `defaultUUID` configured for static fallback
- [ ] `requires` defined for services with dependencies
- [ ] Template variables use correct syntax: `{{{service_variable}}}`

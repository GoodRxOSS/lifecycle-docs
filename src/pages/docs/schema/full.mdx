---
title: Lifecycle Full Schema
description: Complete annotated schema reference for lifecycle.yaml with all configuration options, defaults, and descriptions.
navtext: All at once
tags:
  - schema
  - lifecycle
  - reference
date: "2025-01-17"
---

import { Callout } from "nextra/components";

## Full Lifecycle Schema

Below is the complete `lifecycle.yaml` schema with detailed comments explaining each field, its type, whether it's required, and default values.

<Callout type="info">
  This is a comprehensive reference. For topic-specific documentation, see the
  individual schema pages for [Environment](/docs/schema/environment), [Docker
  Services](/docs/schema/docker-services), [GitHub
  Services](/docs/schema/github-services), and [Helm
  Services](/docs/schema/helm-services).
</Callout>

```yaml
# ============================================================================
# LIFECYCLE SCHEMA v1.0.0
# Complete configuration reference for lifecycle.yaml
# ============================================================================

# Schema version (required)
# Type: string
# Valid values: "1.0.0"
version: "1.0.0"

# ============================================================================
# ENVIRONMENT CONFIGURATION
# Controls global deployment behavior and service selection
# ============================================================================
environment:
  # Automatically deploy when a PR is opened or reopened
  # Type: boolean | Required: No | Default: false
  # When true: environments deploy immediately when PRs are opened
  # When false: must manually add lifecycle-deploy! label
  autoDeploy: false

  # Create GitHub Deployments for tracking in GitHub UI
  # Type: boolean | Required: No | Default: false
  # Enables deployment status in PR timeline and Environments page
  githubDeployments: false

  # Post status comments on pull requests
  # Type: boolean | Required: No | Default: false
  # Includes deployment progress, service URLs, and checkboxes
  # Can also enable per-PR with lifecycle-status-comments! label
  useGithubStatusComment: false

  # Feature flags to enable special behaviors
  # Type: array of strings | Required: No | Default: []
  # Available flags:
  #   - "no-default-env-resolve": Prevents resolution to default UUIDs
  #   - "hack-force-pull-request-branch": Forces services to use PR branch
  #   - "hack-force-pull-request-service-<name>": Per-service PR branch hack
  enabledFeatures:
    - "no-default-env-resolve"

  # Services that always deploy with the environment
  # Type: array | Required: No
  defaultServices:
    - # Service name (must match a defined service)
      # Type: string | Required: Yes
      name: ""
      # GitHub repository for external services (org/repo format)
      # Type: string | Required: No (only for external services)
      repository: ""
      # Branch for external services
      # Type: string | Required: No (only for external services)
      branch: ""

  # Services that can be optionally enabled through PR interface
  # Type: array | Required: No
  optionalServices:
    - # Same structure as defaultServices
      name: ""
      repository: ""
      branch: ""

  # Webhooks for custom automation on deployment events
  # Type: array | Required: No
  webhooks:
    - # Webhook identifier for logging
      # Type: string | Required: No
      name: ""

      # Human-readable description
      # Type: string | Required: No
      description: ""

      # When the webhook fires
      # Type: string | Required: Yes
      # Valid values: "deployed", "error", "torn_down"
      state: "deployed"

      # How the webhook executes
      # Type: string | Required: Yes
      # Valid values: "docker", "command", "codefresh"
      type: "docker"

      # Docker webhook configuration (when type: "docker")
      docker:
        # Docker image to run
        # Type: string | Required: Yes
        image: ""
        # Command to execute (overrides entrypoint)
        # Type: array | Required: No
        command: []
        # Arguments passed to command
        # Type: array | Required: No
        args: []
        # Maximum execution time in seconds
        # Type: number | Required: No | Default: 1800
        # Min: 1, Max: 86400 (24 hours)
        timeout: 1800

      # Command webhook configuration (when type: "command")
      command:
        # Container image to run script in
        # Type: string | Required: Yes
        image: ""
        # Shell script to execute
        # Type: string | Required: Yes
        script: ""
        # Maximum execution time in seconds
        # Type: number | Required: No | Default: 1800
        timeout: 1800

      # Codefresh webhook configuration (when type: "codefresh")
      # Type: string | Required: Yes (for codefresh type)
      pipelineId: ""
      # Type: string | Required: Yes (for codefresh type)
      trigger: ""

      # Environment variables passed to the webhook
      # Type: object | Required: Yes
      # Supports template variables: {{service_publicUrl}}, {{build_uuid}}
      env: {}

# ============================================================================
# SERVICES CONFIGURATION
# Define individual services in your environment
# ============================================================================
services:
  # --------------------------------------------------------------------------
  # GITHUB SERVICE TYPE
  # Build and deploy from GitHub source code
  # --------------------------------------------------------------------------
  - # Unique service identifier
    # Type: string | Required: Yes
    name: ""

    # Short identifier for registry organization
    # Type: string | Required: No
    # Used for image path: {registry}/{appShort}/lfc
    appShort: ""

    # Fallback UUID for inactive services
    # Type: string | Required: No
    defaultUUID: ""

    # Services that must be included when this service deploys
    # Type: array | Required: No
    requires:
      - name: ""

    # Services that must deploy before this one
    # Type: array of strings | Required: No
    # Only affects order, doesn't auto-include services
    deploymentDependsOn:
      - ""

    # GitHub-specific configuration
    github:
      # GitHub repository (org/repo format)
      # Type: string | Required: Yes
      repository: ""

      # Branch to build from
      # Type: string | Required: Yes
      branchName: ""

      # Docker build configuration
      docker:
        # Default image tag when not building from commit
        # Type: string | Required: Yes
        defaultTag: ""

        # External CI/CD pipeline ID (for Codefresh)
        # Type: string | Required: No
        pipelineId: ""

        # Custom ECR repository URL
        # Type: string | Required: No
        ecr: ""

        # Build engine configuration
        builder:
          # Build engine to use
          # Type: string | Required: No
          # Valid values: "buildkit", "kaniko"
          # buildkit: Faster with better caching (recommended)
          # kaniko: Builds without Docker daemon
          engine: "buildkit"

        # Main application container configuration
        app:
          # Path to Dockerfile (relative to repo root)
          # Type: string | Required: Yes
          dockerfilePath: ""

          # Override container entrypoint
          # Type: string | Required: No
          command: ""

          # Arguments passed to command
          # Type: string | Required: No
          # Use %%SPLIT%% delimiter for multiple args
          arguments: ""

          # Environment variables for the container
          # Type: object | Required: No
          # Supports template variables: {{service_internalHostname}}
          env: {}

          # Ports exposed by the container
          # Type: array | Required: No | Default: ["8080"]
          ports:
            - "8080"

          # Post-build pipeline configuration
          afterBuildPipelineConfig:
            # Pipeline ID to run after build
            # Type: string | Required: No
            afterBuildPipelineId: ""
            # Run pipeline asynchronously
            # Type: boolean | Required: No | Default: false
            detatchAfterBuildPipeline: false
            # Pipeline description
            # Type: string | Required: No
            description: ""

        # Init container configuration (runs before main app)
        init:
          # Path to init container Dockerfile
          # Type: string | Required: Yes (if using init)
          dockerfilePath: ""
          # Init container command
          # Type: string | Required: No
          command: ""
          # Init container arguments
          # Type: string | Required: No
          arguments: ""
          # Init container environment variables
          # Type: object | Required: No
          env: {}

      # Deployment configuration
      # NOTE: This entire block only applies to docker and github services
      # Helm services configure deployment settings through chart values instead
      deployment:
        # Create Kubernetes Ingress for hostname access
        # Type: boolean | Required: No | Default: false
        # Applies to: docker and github services only (not helm)
        # true: Lifecycle creates Ingress, service accessible via hostname
        # false: No Ingress, service only accessible within cluster
        # Note: For helm services, ingress is managed by the chart itself
        public: false

        # Compute capacity type
        # Type: string | Required: No | Default: "SPOT"
        # Valid values: "ON_DEMAND", "SPOT"
        # ON_DEMAND: Standard instances (production, databases)
        # SPOT: Cost-savings, may be interrupted (fault-tolerant workloads)
        capacityType: "SPOT"

        # CPU and memory resource allocation
        resource:
          cpu:
            # Minimum CPU guaranteed
            # Type: string | Required: No
            # Format: "100m", "0.5", "2" (Kubernetes CPU units)
            request: ""
            # Maximum CPU allowed
            # Type: string | Required: No
            limit: ""
          memory:
            # Minimum memory guaranteed
            # Type: string | Required: No
            # Format: "128Mi", "512Mi", "1Gi", "2Gi"
            request: ""
            # Maximum memory allowed
            # Type: string | Required: No
            limit: ""

        # Health check configuration
        readiness:
          # Disable readiness checks entirely
          # Type: boolean | Required: No | Default: false
          disabled: false

          # TCP socket health check port
          # Type: number | Required: No
          # Use either tcpSocketPort OR httpGet, not both
          tcpSocketPort: 0

          # HTTP health check configuration
          httpGet:
            # Health check endpoint path
            # Type: string | Required: No
            path: ""
            # Health check port
            # Type: number | Required: No
            port: 0

          # Seconds before first health check
          # Type: number | Required: No | Default: 0
          initialDelaySeconds: 0

          # Seconds between health checks
          # Type: number | Required: No | Default: 10
          periodSeconds: 10

          # Seconds to wait for response
          # Type: number | Required: No | Default: 1
          timeoutSeconds: 1

          # Consecutive successes before healthy
          # Type: number | Required: No | Default: 1
          successThreshold: 1

          # Consecutive failures before unhealthy
          # Type: number | Required: No | Default: 3
          failureThreshold: 3

        # Custom hostname configuration
        hostnames:
          # Custom hostname domain suffix
          # Type: string | Required: No
          host: ""
          # AWS ACM certificate ARN for TLS
          # Type: string | Required: No
          acmARN: ""
          # Internal DNS hostname fallback
          # Type: string | Required: No
          defaultInternalHostname: ""
          # Default public URL fallback
          # Type: string | Required: No
          defaultPublicUrl: ""

        # Network and routing configuration
        network:
          # IP addresses/CIDR ranges allowed to access service
          # Type: array | Required: No
          ipWhitelist:
            - ""

          # Map URL paths to container ports
          # Type: object | Required: No
          # Example: "/api": "8080", "/metrics": "9090"
          pathPortMapping: {}

          # Map external ports to container ports
          # Type: object | Required: No
          # Example: "80": "8080", "443": "8443"
          hostPortMapping: {}

          # gRPC configuration
          grpc:
            # Enable gRPC support
            # Type: boolean | Required: No | Default: false
            enable: false
            # gRPC hostname
            # Type: string | Required: No
            host: ""
            # Default gRPC hostname
            # Type: string | Required: No
            defaultHost: ""

        # Persistent storage volumes
        serviceDisks:
          - # Unique volume identifier
            # Type: string | Required: Yes
            name: ""
            # Container mount path
            # Type: string | Required: Yes
            mountPath: ""
            # Volume size (e.g., "10Gi", "20Gi")
            # Type: string | Required: Yes
            storageSize: ""
            # Volume access mode
            # Type: string | Required: No | Default: "ReadWriteOnce"
            # Valid values: "ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"
            accessModes: "ReadWriteOnce"
            # Storage medium
            # Type: string | Required: No
            # Valid values: "EBS", "DISK", "MEMORY"
            # Note: EBS switches deployment to Recreate strategy
            medium: ""

        # Helm-based deployment for this service
        helm:
          # Enable Helm deployment
          # Type: boolean | Required: No | Default: false
          enabled: false
          # Helm chart name
          # Type: string | Required: No
          chartName: ""
          # Chart repository URL
          # Type: string | Required: No
          chartRepoUrl: ""
          # Chart version
          # Type: string | Required: No
          chartVersion: ""
          # Command to check status
          # Type: string | Required: No
          cmdPs: ""
          # Helm action
          # Type: string | Required: No | Default: "install"
          # Valid values: "install", "upgrade"
          action: "install"
          # Custom values (key=value format)
          # Type: array | Required: No
          customValues:
            - ""
          # Custom value files
          # Type: array | Required: No
          customValueFiles:
            - ""
          # Helm CLI version
          # Type: string | Required: No
          helmVersion: ""
          # PVC attachment configuration
          attachPvc:
            # Enable PVC attachment
            # Type: boolean | Required: No | Default: false
            enabled: false
            # PVC mount path
            # Type: string | Required: No
            mountPath: ""

        # Node selector labels for scheduling
        # Type: object | Required: No
        node_selector: {}

        # Advanced node affinity rules (Kubernetes spec)
        # Type: object | Required: No
        node_affinity: {}

  # --------------------------------------------------------------------------
  # DOCKER SERVICE TYPE
  # Deploy pre-built container images
  # --------------------------------------------------------------------------
  - name: ""
    appShort: ""
    defaultUUID: ""
    requires: []
    deploymentDependsOn: []

    # Docker-specific configuration
    docker:
      # Docker image to deploy
      # Type: string | Required: Yes
      # Examples: "redis", "postgres", "123456789.dkr.ecr.us-east-1.amazonaws.com/my-app"
      dockerImage: ""

      # Default image tag
      # Type: string | Required: Yes
      # Examples: "latest", "7-alpine", "15-alpine"
      defaultTag: ""

      # Override container entrypoint
      # Type: string | Required: No
      command: ""

      # Arguments passed to command
      # Type: string | Required: No
      # Use %%SPLIT%% delimiter for multiple args
      arguments: ""

      # Environment variables
      # Type: object | Required: No
      env: {}

      # Exposed ports
      # Type: array | Required: No | Default: ["8080"]
      ports:
        - ""

      # Deployment configuration (same as github.deployment)
      deployment:
        public: false
        capacityType: "SPOT"
        resource:
          cpu:
            request: ""
            limit: ""
          memory:
            request: ""
            limit: ""
        readiness:
          disabled: false
          tcpSocketPort: 0
          httpGet:
            path: ""
            port: 0
          initialDelaySeconds: 0
          periodSeconds: 10
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 3
        hostnames:
          host: ""
          acmARN: ""
          defaultInternalHostname: ""
          defaultPublicUrl: ""
        network:
          ipWhitelist: []
          pathPortMapping: {}
          hostPortMapping: {}
          grpc:
            enable: false
            host: ""
            defaultHost: ""
        serviceDisks: []
        helm:
          enabled: false
          chartName: ""
          chartRepoUrl: ""
          chartVersion: ""
          cmdPs: ""
          action: "install"
          customValues: []
          customValueFiles: []
          helmVersion: ""
          attachPvc:
            enabled: false
            mountPath: ""
        node_selector: {}
        node_affinity: {}

  # --------------------------------------------------------------------------
  # HELM SERVICE TYPE
  # Deploy using Helm charts (public, organization, or local)
  # --------------------------------------------------------------------------
  - name: ""
    appShort: ""
    defaultUUID: ""
    requires: []
    deploymentDependsOn: []

    # Helm-specific configuration
    helm:
      # Deployment method
      # Type: string | Required: No
      # Valid values: "native", "ci"
      # native: Kubernetes jobs (recommended, real-time logs)
      # ci: External CI/CD system (legacy)
      deploymentMethod: "native"

      # Helm CLI version
      # Type: string | Required: Yes (for native)
      # Example: "3.12.0", "3.14.0"
      version: "3.12.0"

      # Additional Helm arguments
      # Type: string | Required: No
      # Example: "--wait --timeout 30m --atomic"
      args: ""

      # GitHub repository for local charts or value files
      # Type: string | Required: Conditional
      # Required for: local charts, org charts with images, public charts with valueFiles
      repository: ""

      # Branch to clone
      # Type: string | Required: When repository is specified
      branchName: ""

      # Chart configuration
      chart:
        # Chart name or path
        # Type: string | Required: Yes
        # Public: "postgresql", "redis"
        # Local: "./charts/my-app" or "../shared/chart"
        # Organization: matches configured org chart name
        name: ""

        # Chart repository URL
        # Type: string | Required: For public charts
        # Standard: "https://charts.bitnami.com/bitnami"
        # OCI: "oci://registry.example.com/charts"
        repoUrl: ""

        # Chart version
        # Type: string | Required: Recommended
        version: ""

        # Custom values (key=value format)
        # Type: array | Required: No
        # Supports template variables and nested paths
        values:
          - "auth.username=admin"
          - "persistence.enabled=true"

        # Value files (relative to repo root)
        # Type: array | Required: No
        # Note: Completely replaces any defaults (no merging)
        valueFiles:
          - "helm/values/base.yaml"

      # Environment variable mapping for Helm values
      envMapping:
        # App container env mapping
        app:
          # Format for transformation
          # Type: string | Required: Yes (when envMapping.app specified)
          # "array": path[0].name=KEY, path[0].value=VALUE
          # "map": path.KEY=VALUE
          format: "array"
          # Helm value path for env vars
          # Type: string | Required: Yes
          path: "deployment.env"
        # Init container env mapping (same structure)
        init:
          format: "array"
          path: "deployment.initContainers[0].env"

      # Docker build configuration (for org/local charts)
      docker:
        # Default image tag
        # Type: string | Required: Yes (when docker specified)
        defaultTag: "latest"

        # Build engine
        builder:
          # Type: string | Valid values: "buildkit", "kaniko"
          engine: "buildkit"

        # App container configuration
        app:
          dockerfilePath: ""
          command: ""
          arguments: ""
          env: {}
          ports: []

        # Init container configuration
        init:
          dockerfilePath: ""
          command: ""
          arguments: ""
          env: {}

      # Resource type for deployment
      # Type: string | Required: No | Default: "deployment"
      # Valid values: "deployment", "statefulset", "daemonset"
      type: "deployment"

      # Enable gRPC support
      # Type: boolean | Required: No | Default: false
      grpc: false

      # Disable automatic ingress host
      # Type: boolean | Required: No | Default: false
      disableIngressHost: false

      # Enable environment lens banner
      # Type: boolean | Required: No | Default: false
      envLens: false
# ============================================================================
# TEMPLATE VARIABLES REFERENCE
# Use in env values: {{variable_name}} or {{{variable_name}}}
# Triple braces {{{ }}} recommended to prevent URL encoding issues
# ============================================================================
# Build Variables:
#   {{build_uuid}}              - Unique environment identifier
#   {{build_namespace}}         - Kubernetes namespace
#   {{build_publicUrl}}         - Environment's public URL
#
# Service Variables (replace 'service' with actual service name):
#   {{service_internalHostname}} - Internal DNS hostname
#   {{service_publicUrl}}        - Public URL (if public: true)
#   {{service_port}}             - First exposed port
#
# GitHub Variables:
#   {{github_repository}}        - Repository name
#   {{github_branch}}            - Branch name
#   {{github_commit}}            - Commit SHA
#   {{github_pr_number}}         - Pull request number
```

---

## Schema Quick Reference

### Environment Section

| Field                    | Type    | Required | Default | Description               |
| ------------------------ | ------- | -------- | ------- | ------------------------- |
| `autoDeploy`             | boolean | No       | `false` | Auto-deploy on PR open    |
| `githubDeployments`      | boolean | No       | `false` | Create GitHub Deployments |
| `useGithubStatusComment` | boolean | No       | `false` | Post PR comments          |
| `enabledFeatures`        | array   | No       | `[]`    | Feature flags             |
| `defaultServices`        | array   | No       | `[]`    | Always-deployed services  |
| `optionalServices`       | array   | No       | `[]`    | On-demand services        |
| `webhooks`               | array   | No       | `[]`    | Event automation          |

### Service Types

| Type     | Use Case                 | Uses `deployment` block |
| -------- | ------------------------ | ----------------------- |
| `github` | Build from source code   | Yes                     |
| `docker` | Deploy pre-built images  | Yes                     |
| `helm`   | Deploy using Helm charts | No (use chart values)   |

### Capacity Types

| Value       | Description                           |
| ----------- | ------------------------------------- |
| `ON_DEMAND` | Standard instances (production)       |
| `SPOT`      | Cost-savings, interruptible (default) |

### Webhook States

| State       | Trigger                            |
| ----------- | ---------------------------------- |
| `deployed`  | All services successfully deployed |
| `error`     | Build or deployment failed         |
| `torn_down` | Environment cleaned up             |

### Build Engines

| Engine     | Description                                   |
| ---------- | --------------------------------------------- |
| `buildkit` | Fast, efficient, better caching (recommended) |
| `kaniko`   | No Docker daemon required                     |
